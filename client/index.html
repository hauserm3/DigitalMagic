<!DOCTYPE HTML>
<html>
<head>

    <title>DigitalMagic</title>

    <link rel="stylesheet" href="./libs/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="./libs/jquery-3.1.0.min.js"></script>
    <script src="./libs/bootstrap.min.js"></script>
    <script src="./src/toolTip.js"></script>

    <style type="text/css">

        #map-canvas {
            height: 900px;
            width: 100%;
        }

    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDYZoEBypb8_mF2GLqrvDE1BrdPQ6aSu8Q"></script>
    <script type="text/javascript" src="./src/myCustomGoogleMapMarker.js"></script>
    <script type="text/javascript">

    </script>

</head>
<body>
<div id="MyBackround">
    <div id="MyContainer">
        <div id="OrganizationList" class="dropdown">
            <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">
                Organization List <span class="caret"></span>
            </button>
            <ul class="dropdown-menu"></ul>
        </div>
        <div id="map-canvas"></div>
        <!--<img src="img/toronto.png">-->
    </div>
</div>
<div id="floatTip"></div>


<script src="./src/myDevice.js"></script>
<script src="./src/myPlaylist.js"></script>
<script src="./src/myModal.js"></script>
<script>
    var devices_arr;
    var globalDispather$ = $({});
    var modal;
    globalDispather$.on('thumbClick',function (evt, obj) {
        if(modal) modal.$view.remove();
        modal = new magic.MyModal(obj);
        $('body').append(modal.$view);
        modal.$view.fadeIn('fast');
        modal.$view.on('click',function (evt) {
            var target = $(evt.target);
//            console.log('targget', target.hasClass('close'));
            console.log('targget', target);
//            if(target.attr('id','Modal') || target.hasClass('close')){
            if(target.hasClass('close') || target.hasClass('modal')){
                modal.$view.fadeOut('fast',function () {
                    modal.$view.remove();
                });
            }
        });
        console.log('obj', obj);
    });
    //        var positions = [
    //            {
    //                left: '200px',
    //                top: '80px'
    //            },
    //            {
    //                left: '860px',
    //                top: '80px'
    //            },
    //            {
    //                left: '750px',
    //                top: '420px'
    //            },
    //            {
    //                left: '310px',
    //                top: '310px'
    //            }
    //
    //        ];

    //        $(document).ready(function () {
    var initialize = function () {
        var LatLng = [
            {Lat: 43.799632, Lng: -79.517201},
            {Lat: 43.793506, Lng: -79.23994},
            {Lat: 43.710955, Lng: -79.28338},
            {Lat: 43.732221, Lng: -79.475403}
        ];
        var myLatlng = new google.maps.LatLng(43.734022, -79.333717);

        var mapOptions = {
            zoom: 12,
            center: myLatlng,
            disableDefaultUI: true
        };

        var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

        var getData = function () {
            $.get('/api/getOrganizationList').done(function (res) {
                console.log('getOrganizationList', res);
                res.forEach(function (item, i, arr) {
                    $('#OrganizationList>ul').append(
                        $('<li>').append(
                            $('<a>').attr('href', item.group_id[0]).text(item.group_name[0]+' (id='+item.group_id[0]+')')));
                });
            }).fail(function (error) {
                console.error('error', error);
            });

            $.get('/api/getDevices/-1').done(function (res) {
                devices_arr = res;
                console.log('getAllDevices ', res);
                var devices = res.devices;
                devices.forEach(function (item, i, arr) {
//                        var Device = new magic.MyDevice(item);
                    // console.log('Device ', Device.deviceConnection);
                    var myMarker = new magic.CustomMarker(
                        new google.maps.LatLng(LatLng[i].Lat, LatLng[i].Lng),
                        map,
                        {
                            marker_id: 'myMarker',
                            color: 'red'
                        },
                        item
                    );
                    google.maps.event.addListener(myMarker, 'click', function() {
                        console.log('arg', arguments);
//                        map.setCenter(RdrMarker.getPosition());
//                        infowindow.setContent(contentStringRdr);
//                        infowindow.open(map,RdrMarker);
                    });
//                        Device.createDeviceBlock(positions[i]);
                });

            }).fail(function (error) {
                console.error('error', error);
            });
        };

        getData();
//            setInterval(function(){getData()},10000);
    };

    google.maps.event.addDomListener(window, 'load', initialize);
</script>

</body>
</html>
